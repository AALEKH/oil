# dummy, cpp-coverage

# Debian bullseye has podman
image: debian/bullseye
packages:
  # for running soil on the host
  - python2
  - time
  - zip
  # podman and its missing dependencies
  - podman
  - uidmap
  - slirp4netns

secrets:
  - 2678474d-b22b-449f-a19a-16cb403c94cd

tasks:
  - mount-perms: |
      cd oil
      soil/host-shim.sh mount-perms $PWD

      #  Disabled because of weird podman bug
      #  See soil/host-shim.sh podman-prune / show-disk-info
      #
      #  - dummy: |
      #      cd oil
      #      soil/host-shim.sh run-job-uke podman $PWD dummy
      #
      #  # Relies on SSH key, so do it outside the container
      #  - publish-dummy: |
      #      cd oil
      #      soil/sourcehut.sh publish-html-assuming-ssh-key
      #
      #  # Outside container
      #  - job-reset-1: |
      #      cd oil
      #      soil/host-shim.sh job-reset

  - cpp-coverage: |
      cd oil
      soil/host-shim.sh run-job-uke podman $PWD cpp-coverage

  - publish-cpp-coverage: |
      cd oil
      soil/sourcehut.sh publish-html-assuming-ssh-key
