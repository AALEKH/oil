"""
asdl/NINJA_subgraph.py
"""

from __future__ import print_function

from build.ninja_lib import log

_ = log


def NinjaGraph(ru):
  n = ru.n

  n.comment('Generated by %s' % __name__)
  n.newline()

  n.rule('asdl-cpp',
         command='_bin/shwrap/asdl_main $action $asdl_flags $in $out_prefix $debug_mod',
         description='asdl_main $action $asdl_flags $in $out_prefix $debug_mod')
  n.newline()

  # For pretty printing
  ru.asdl_cc('asdl/hnode.asdl', pretty_print_methods=False)

  # For unit tests
  ru.asdl_cc('asdl/examples/demo_lib.asdl')
  ru.asdl_cc('asdl/examples/typed_arith.asdl')
  ru.asdl_cc('asdl/examples/typed_demo.asdl')

  if 0:
    ru.cc_binary('asdl/gen_cpp_test.cc')
    ru.cc_binary('asdl/gc_test.cc')
    # Dependencies
    #
    # //mycpp/runtime
    #
    # The issue here is that the main
    # asdl_deps = ['asdl/examples/typed_demo.asdl']

    # cc_library can mean compile_one, while cc_binary means link
    #
    # The problem is that the object file can have an implicit dependency on ASDL
    # i.e. compile_one actions in both cc_binary and cc_library can depend on
    # ASDL-generated headers.
